<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>控制台页面</title>
		<link rel="stylesheet" href="${ctxPath}/assets/libs/layui/css/layui.css">
		<link rel="stylesheet" href="${ctxPath}/assets/css/index.css">
		<script type="text/javascript" src="${ctxPath}/assets/libs/layui/layui.js" charset="utf-8"></script>
	</head>
	<body>
		<div class="wrap-container welcome-container">
			<div class="row">
				<div class="welcome-left-container col-lg-9">
					<div class="data-show">
						<ul class="clearfix">
							<li class="col-sm-12 col-md-4 col-xs-12">
								<a href="javascript:;" class="clearfix">
									<div class="icon-bg bg-org f-l">
										<span class="iconfont">&#xe606;</span>
									</div>
									<div class="right-text-con">
										<p class="name">当天能耗</p>
										<p><span class="color-org" id="currentEnergy">89</span>千瓦时<span class="iconfont"><i class="layui-icon-up"></i></span></p>
									</div>
								</a>
							</li>
							<li class="col-sm-12 col-md-4 col-xs-12">
								<a href="javascript:;" class="clearfix">
									<div class="icon-bg bg-blue f-l">
										<span class="iconfont">&#xe602;</span>
									</div>
									<div class="right-text-con">
										<p class="name">当月能耗</p>
										<p><span class="color-blue" id="monthEnergy">189</span>千瓦时<span class="iconfont">&#xe628;</span></p>
									</div>
								</a>
							</li>
							<li class="col-sm-12 col-md-4 col-xs-12">
								<a href="javascript:;" class="clearfix">
									<div class="icon-bg bg-green f-l">
										<span class="iconfont">&#xe605;</span>
									</div>
									<div class="right-text-con">
										<p class="name">累计耗能</p>
										<p><span class="color-green" id="totalEnergy">221</span>千瓦时<span class="iconfont">&#xe60f;</span></p>
									</div>
								</a>
							</li>
						</ul>
					</div>
					<!--图表-->
					<div class="chart-panel panel panel-default">
						<div class="panel-body" id="chart" style="height: 376px;">
						</div>
					</div>
					<!--服务器信息-->
					<div class="server-panel panel panel-default">
						<div class="panel-header">服务器信息</div>
						<div class="panel-body clearfix">
							<div class="col-md-2">
								<p class="title">服务器环境</p>
								<span class="info">${serverVmName}</span>
							</div>
							<div class="col-md-2">
								<p class="title">服务器IP地址</p>
								<span class="info">${serverIp}   </span>
							</div>
							<div class="col-md-2">
								<p class="title">服务器域名</p>
								<span class="info">${serverDomain} </span>
							</div>
							<div class="col-md-2">
								<p class="title"> Java版本</p>
								<span class="info">${javaVersion}</span>
							</div>
							<div class="col-md-2">
								<p class="title">操作系统</p>
								<span class="info">${serverOsName} </span>
							</div>
							<div class="col-md-2">
								<p class="title">服务器当前时间</p>
								<span class="info">${serverTime}</span>
							</div>
						</div>
					</div>
				</div>
				<div class="welcome-edge col-lg-3">
					<!--最新留言-->
					<div class="panel panel-default comment-panel">
						<div class="panel-header">最新操作</div>
						<div class="panel-body">
							
							<div class="commentbox">
								<ul class="commentList" id="commentList">
								 <!--  <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="${ctxPath}/assets/images/head.png"></i></a>
								    <div class="comment-main">
								      <header class="comment-header">
								        <div class="comment-meta"><a class="comment-author" href="#">慕枫</a> 评论于
								          <time title="2014年8月31日 下午3:20" datetime="2014-08-31T03:54:20">2014-8-31 15:20</time>
								        </div>
								      </header>
								      <div class="comment-body">
								        <p><a href="#">@某人</a> 系统真不错！！！</p>
								      </div>
								    </div>
								  </li>
								  <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="${ctxPath}/assets/images/head.png"></i></a>
								    <div class="comment-main">
								      <header class="comment-header">
								        <div class="comment-meta"><a class="comment-author" href="#">慕枫</a> 评论于
								          <time title="2014年8月31日 下午3:20" datetime="2014-08-31T03:54:20">2014-8-31 15:20</time>
								        </div>
								      </header>
								      <div class="comment-body">
								        <p><a href="#">@某人</a> 系统真不错！！！</p>
								      </div>
								    </div>
								  </li>
								   <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="${ctxPath}/assets/images/head.png"></i></a>
								    <div class="comment-main">
								      <header class="comment-header">
								        <div class="comment-meta"><a class="comment-author" href="#">慕枫</a> 评论于
								          <time title="2014年8月31日 下午3:20" datetime="2014-08-31T03:54:20">2014-8-31 15:20</time>
								        </div>
								      </header>
								      <div class="comment-body">
								        <p><a href="#">@某人</a> 系统真不错！！！</p>
								      </div>
								    </div>
								  </li>
								  <li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="${ctxPath}/assets/images/head.png"></i></a>
								    <div class="comment-main">
								      <header class="comment-header">
								        <div class="comment-meta"><a class="comment-author" href="#">慕枫</a> 评论于
								          <time title="2014年8月31日 下午3:20" datetime="2014-08-31T03:54:20">2014-8-31 15:20</time>
								        </div>
								      </header>
								      <div class="comment-body">
								        <p><a href="#">@某人</a> 系统真不错！！！</p>
								      </div>
								    </div>
								  </li> -->
								</ul>
							</div>
							<div id="pagesbox" style="text-align: center;padding-top: 5px;">
								
							</div>
						</div>
					</div>
					<!--联系-->
					<div class="panel panel-default contact-panel">
						<div class="panel-header">联系我们</div>
						<div class="panel-body">
							<p>QQ：475327011</p>
							<p>E-mail:zljtport@163.com</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="${ctxPath}/assets/libs/echarts/echarts.min.js"></script>
		<script type="text/javascript">
			layui.use(['layer','jquery'], function(){
				var layer 	= layui.layer;
				var $=layui.jquery;
				//图表
				var myChart;
                myChart = echarts.init(document.getElementById('chart'));
                myChart.setOption(
                    {
                        title: {
                            text: "数据统计",
                            textStyle: {
                                color: "rgb(85, 85, 85)",
                                fontSize: 18,
                                fontStyle: "normal",
                                fontWeight: "normal"
                            }
                        },
                        tooltip: {
                            trigger: "axis"
                        },
                        legend: {
                            data: ["灯塔", "路灯", "所有"],
                            selectedMode: false,
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                dataView: {
                                    show: false,
                                    readOnly: true
                                },
                                magicType: {
                                    show: false,
                                    type: ["line", "bar", "stack", "tiled"]
                                },
                                restore: {
                                    show: true
                                },
                                saveAsImage: {
                                    show: true
                                },
                                mark: {
                                    show: false
                                }
                            }
                        },
                        calculable: false,
                        xAxis: [
                            {
                                type: "category",
                                boundaryGap: false,
                                data: ["周一", "周二", "周三", "周四", "周五", "周六", "周日"]
                            }
                        ],
                        yAxis: [
                            {
                                type: "value"
                            }
                        ],
                        grid: {
                            x2: 30,
                            x: 50
                        }/* ,
                        series: [
                            {
                                name: "灯塔",
                                type: "line",
                                smooth: true,
                                itemStyle: {
                                    normal: {
                                        areaStyle: {
                                            type: "default"
                                        }
                                    }
                                },
                                data: [10, 12, 21, 54, 260, 830, 710]
                            },
                            {
                                name: "路灯",
                                type: "line",
                                smooth: true,
                                itemStyle: {
                                    normal: {
                                        areaStyle: {
                                            type: "default"
                                        }
                                    }
                                },
                                data: [30, 182, 434, 791, 390, 30, 10]
                            },
                            {
                                name: "所有",
                                type: "line",
                                smooth: true,
                                itemStyle: {
                                    normal: {
                                        areaStyle: {
                                            type: "default"
                                        },
                                        color: "rgb(110, 211, 199)"
                                    }
                                },
                                data: [1320, 1132, 601, 234, 120, 90, 20]
                            }
                        ] */
                    }
                );

				$(window).resize(function(){
					myChart.resize();
				})
				//当天能耗开始
				$.post('light/energy/currentEnergy', {
					lampId: 0
                }, function (res) {
                    layer.closeAll('loading');
                    if (res.code == 200) {
                        //layer.msg(res.msg, {icon: 1});
                        $("#currentEnergy").html(res.energy);
                        //insTb.reload();
                    } else {
                        //layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
				//当天能耗结束
				
				//当月能耗开始
				$.post('light/energy/monthEnergy', {
					lampId: 0
                }, function (res) {
                    layer.closeAll('loading');
                    if (res.code == 200) {
                        //layer.msg(res.msg, {icon: 1});
                        $("#monthEnergy").html(res.energy);
                        //insTb.reload();
                    } else {
                        //layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
				//当月能耗结束
				
				//累计能耗开始
				$.post('light/energy/totalEnergy', {
					lampId: 0
                }, function (res) {
                    layer.closeAll('loading');
                    if (res.code == 200) {
                        //layer.msg(res.msg, {icon: 1});
                        $("#totalEnergy").html(res.energy);
                        //insTb.reload();
                    } else {
                        //layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
				//累计能耗结束
				
				//本周能耗开始
				$.post('light/energy/weeklyEnergy', {
					lampId: 0
                }, function (res) {
                    layer.closeAll('loading');
                    if (res.code == 200) {
                        //layer.msg(res.msg, {icon: 1});
                        //---------------------------------------------报表设置开始
                         myChart.setOption(
	                    {
	                    	series: [
	                            {
	                                name: "灯塔",
	                                type: "line",
	                                smooth: true,
	                                itemStyle: {
	                                    normal: {
	                                        areaStyle: {
	                                            type: "default"
	                                        }
	                                    }
	                                },
	                                data: res.lighthouseenergy
	                            },
	                            {
	                                name: "路灯",
	                                type: "line",
	                                smooth: true,
	                                itemStyle: {
	                                    normal: {
	                                        areaStyle: {
	                                            type: "default"
	                                        }
	                                    }
	                                },
	                                data: res.lightenergy
	                            },
	                            {
	                                name: "所有",
	                                type: "line",
	                                smooth: true,
	                                itemStyle: {
	                                    normal: {
	                                        areaStyle: {
	                                            type: "default"
	                                        },
	                                        color: "rgb(110, 211, 199)"
	                                    }
	                                },
	                                data: res.energy
	                            }
	                        ] 
	                    });
                        //---------------------------------------------报表设置结束
                        //insTb.reload();
                    } else {
                        //layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
				//本周能耗结束
				
				//最新操作开始
				$.post('light/operate/topOperate', {
					lampId: 0
                }, function (res) {
                    layer.closeAll('loading');
                    if (res.code == 200) {
                    	var data = res.operate ;
                    	var innerHtml = "";
                    	for(var i = 0 ;i < data.length;i++){
                    		var avatar = "${ctxPath}"+(data[i].memo!=null&&data[i].memo!=''?('/light/user/img/'+data[i].memo): '/assets/images/head.png');
                    		innerHtml = innerHtml + '<li class="item cl"> <a href="#"><i class="avatar size-L radius"><img alt="" src="'+avatar+'"></i></a>'
							    +'<div class="comment-main">'
							      +'<header class="comment-header">'
							        +'<div class="comment-meta"><a class="comment-author" href="#">'+data[i].nickname+'</a> 操作于'
							          +'<time title="'+crtTimeFttc(data[i].updateTime)+'" datetime="'+data[i].updateTime+'">'+crtTimeFtt(data[i].updateTime)+'</time>'
							        +'</div>'
							      +'</header>'
							      +'<div class="comment-body">'
							        +'<p><a href="#"></a> '+data[i].operatecontent+'</p>'
							      +'</div>'
							    +'</div>'
							  +'</li>' ;
                    	}
                    	$('#commentList').html(innerHtml);
                        //layer.msg(res.msg, {icon: 1});
                        //insTb.reload();
                    } else {
                        //layer.msg(res.msg, {icon: 2});
                    }
                }, 'json');
				//最新操作结束
				function crtTimeFtt(val) {
				    if (val != null) {
			            var date = new Date(val);
			            var month = (date.getMonth() + 1) ;
			            if(month < 10){
			            	month = "0"+month ;
			            }
			            return date.getFullYear() + '-' + month + '-' + date.getDate()+' '+date.getHours()+':'+date.getMinutes();
			        }else{
			        	return val;
			        }
				}
				function crtTimeFttc(val) {
				    if (val != null) {
			            var date = new Date(val);
			            return date.getFullYear() + '年' + (date.getMonth() + 1) + '月' + date.getDate()+'日 '+date.getHours()+':'+date.getMinutes()+' 第'+Math.floor((date.getMonth()+3)/3)+' 季度';
			        }else{
			        	return val;
			        }
				}
				//end
			});
		</script>
	</body>
</html>
